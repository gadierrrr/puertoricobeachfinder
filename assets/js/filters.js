function filterBeachesClient(t){let e=[...t];if(state.selectedTags.length>0&&(e=e.filter(t=>{const e=t.tags||[];return state.selectedTags.some(t=>e.includes(t))})),state.selectedMunicipality&&(e=e.filter(t=>t.municipality===state.selectedMunicipality)),state.userLocation){const t=1e3*state.maxDistance;e=e.filter(e=>{const a=calculateDistance(state.userLocation.lat,state.userLocation.lng,parseFloat(e.lat),parseFloat(e.lng));return e._distance=a,a<=t})}return e=sortBeaches(e),e}function sortBeaches(t){const e=[...t];switch(state.sortBy){case"distance":state.userLocation&&(e.forEach(t=>{void 0===t._distance&&(t._distance=calculateDistance(state.userLocation.lat,state.userLocation.lng,parseFloat(t.lat),parseFloat(t.lng)))}),e.sort((t,e)=>(t._distance||0)-(e._distance||0)));break;case"rating":e.sort((t,e)=>{const a=t.google_rating||0,s=e.google_rating||0;return s!==a?s-a:t.name.localeCompare(e.name)});break;default:e.sort((t,e)=>t.name.localeCompare(e.name))}return e}function getFilterParams(){const t=new URLSearchParams;return state.selectedTags.length>0&&state.selectedTags.forEach(e=>t.append("tags[]",e)),state.selectedMunicipality&&t.set("municipality",state.selectedMunicipality),state.sortBy&&"name"!==state.sortBy&&t.set("sort",state.sortBy),state.viewMode&&"list"!==state.viewMode&&t.set("view",state.viewMode),state.userLocation&&50!==state.maxDistance&&t.set("maxDistance",state.maxDistance),t}function parseFiltersFromURL(){const t=new URLSearchParams(window.location.search);state.selectedTags=t.getAll("tags[]")||[],state.selectedMunicipality=t.get("municipality")||"",state.sortBy=t.get("sort")||"name",state.viewMode=t.get("view")||"list";const e=t.get("maxDistance");e&&(state.maxDistance=parseInt(e))}function syncTagUI(){document.querySelectorAll(".tag-btn").forEach(t=>{const e=t.dataset.tag;state.selectedTags.includes(e)?(t.classList.add("bg-blue-600","text-white"),t.classList.remove("bg-gray-100","text-gray-700","hover:bg-gray-200")):(t.classList.remove("bg-blue-600","text-white"),t.classList.add("bg-gray-100","text-gray-700","hover:bg-gray-200"))})}function debounce(t,e){let a;return function(...s){clearTimeout(a),a=setTimeout(()=>{clearTimeout(a),t(...s)},e)}}const debouncedApplyFilters=debounce(applyFilters,300);document.addEventListener("DOMContentLoaded",()=>{const t=document.getElementById("distance-filter");t&&t.addEventListener("input",t=>{const e=t.target.value,a=document.getElementById("distance-value");a&&(a.textContent=e+"km")})});